---
import childProcess from 'child_process';

import Favicon from '../components/Favicon.astro';
import Header from '../components/Header.astro';
import Banner from '../components/Banner.astro';
import Footer from '../components/Footer.astro';
import Mobilenav from '../components/Mobilenav.astro';
import Favicon from '../components/Favicon.astro';
import DashboardScript from '../components/DashboardScript.astro';

import { getMainClassName } from '../utils/utils.ts';

const { frontmatter } = Astro.props;

// Import Envision from source files
import '../../../../envision/src/scss/base.scss';
// Import docs specific styles
import '../../assets/scss/docs.scss';

const title = frontmatter.title;

// obtain Git commit hash for cache busting
const commitHash = childProcess
   .execSync('git rev-parse --short HEAD')
   .toString()
   .trim();
---

<!doctype html>
<html lang="en">
   <head>
      <meta charset="utf-8" />
      {
         frontmatter.indexing === false && (
            <meta name="robots" content="noindex" />
         )
      }
      <title>
         {
            `${title ? title : ''}${title ? ' \u00B7 ' : ''}Envision by Sitevision`
         }
      </title>
      <meta name="viewport" content="width=device-width, initial-scale=1" />
      {
         frontmatter.description && (
            <meta name="description" content={frontmatter.description} />
         )
      }
      <script is:inline>
         ((win, docEl, key) => {
            const st = win.sessionStorage;
            const pref = st.getItem(key);
            let cls;
            if (pref) {
               cls = pref;
            } else {
               cls = win.matchMedia('(prefers-color-scheme: dark)').matches
                  ? 'doc-dark-mode'
                  : 'doc-light-mode';
               st.setItem(key, cls);
            }
            docEl.classList.add(cls);
         })(window, document.documentElement, 'colorscheme');
      </script>
      <Favicon />
      <meta
         name="generator"
         data-template={frontmatter.template}
         content={Astro.generator}
      />
      <script
         is:inline
         src="https://code.jquery.com/jquery-3.7.1.slim.min.js"
         integrity="sha256-kmHvs0B+OpCW5GVHUNjv9rOmY0IvSIRcf7zGUDTDQM8="
         crossorigin="anonymous"></script>

      <script is:inline src={`/dist/envision.js?v=${commitHash}`}></script>

      {
         !!frontmatter.dashboard && (
            <link
               rel="stylesheet"
               href={`/dist/envision-dashboard.css?v=${commitHash}`}
            />
         )
      }
      <!-- Additional head elements -->
   </head>
   <body>
      <div class="layout">
         <Header frontmatter={frontmatter} />
         <Banner frontmatter={frontmatter} />
         <slot name="main-content">
            <div class="body">
               <main
                  id="content"
                  class={getMainClassName(frontmatter.dashboard)}
               >
                  <div class="content-wrapper">
                     {
                        title && (
                           <h1 class="doc-main-heading">
                              {title}
                              {frontmatter.since && (
                                 <span class="doc-badge doc-badge--info">
                                    Since {frontmatter.since}
                                 </span>
                              )}
                           </h1>
                        )
                     }
                     <slot />
                  </div>
               </main>
               <slot name="sidenav" />
            </div>
         </slot>
         <Footer />
         <Mobilenav frontmatter={frontmatter} />
         {!!frontmatter.dashboard}
      </div>
      <script src="../../assets/scripts/init-code-blocks.js"></script>
      <script src="../../assets/scripts/init-examples.js"></script>
      <script src="../../assets/scripts/mobile-nav.js"></script>
      <script src="../../assets/scripts/theme-picker.js"></script>
      {!!frontmatter.dashboard && <DashboardScript />}
   </body>
</html>
