@use '../abstracts/functions';
@use '../abstracts/mixins/focus';
@use '../abstracts/mixins/form';
@use '../abstracts/scss-variables' as *;

@use 'sass:math';

.env-select {
   position: relative;

   &.single {
      // Single select version
      .env-select__input {
         padding-block-start: 0.25em;
         padding-inline-end: 2em;
         padding-block-end: 0.25em;
         padding-inline-start: 0.5em;

         > input {
            min-width: 0;
         }
      }

      .env-select__item {
         font-size: 1em;
         background-color: transparent;
         color: var(--env-form-input-font-color);
         padding-block: 0.5625em;
         padding-inline: 0.25em;
      }

      > .env-icon {
         pointer-events: none;
         display: block;
         position: absolute;
         inset-block-start: 50%;
         inset-inline-end: 0.9375em;
         transform: translateY(-50%);
         width: 0.875em;
         height: 0.875em;
      }
   }

   &__input {
      display: flex;
      flex-wrap: wrap;
      align-items: baseline;
      font-family: inherit;
      background-color: var(--env-form-input-background-color);
      background-image: none;
      border: $border-width $border-style var(--env-form-input-border-color);
      border-radius: var(--env-form-input-border-radius);
      box-sizing: border-box;
      color: var(--env-form-input-font-color);
      font-size: var(--env-font-size-medium);
      line-height: 1;
      margin-block: 0;
      margin-inline: 0;
      padding-block: 0.25em;
      padding-inline: 0.25em;
      transition:
         border-color 0.2s ease-in-out,
         box-shadow 0.2s ease-in-out;
      width: 100%;
      min-height: (math.div($form-input-height, $BROWSER_FONT_SIZE) * 1em);
      cursor: text;
      overflow: hidden;

      .env-select.has-items & {
         padding-inset-block-end: 0;
      }

      .env-select.plugin-clear_button & {
         padding-inset-inline-end: 1.5em;
      }

      > * {
         vertical-align: baseline;
         display: inline-flex;
      }

      > input {
         background: none;
         color: var(--env-form-input-font-color);
         border: 0;
         box-shadow: none;
         display: inline-block;
         flex: 1 1 auto;
         font-size: 1em;
         line-height: math.div(34, $BROWSER_FONT_SIZE);
         margin-block-start: 0;
         margin-inline-end: 0;
         margin-block-end: 0;
         margin-inline-start: functions.em(4px);
         max-height: none;
         max-width: 100%;
         min-height: 0;
         min-width: 7rem;
         padding-block: 0;
         padding-inline: 0;
         text-indent: 0;
         user-select: auto;

         @include form.placeholder {
            color: var(--env-form-input-font-color);
            filter: opacity(0.65);
         }

         &:focus {
            @include focus.wcagSafeOutlineNone;
         }
      }

      .env-select.full & > input,
      .env-select.input-hidden & > input {
         inset-inline-start: -10000px;
         opacity: 0;
         position: absolute;
      }

      .env-select.focus & {
         @include focus.focus-outline();
      }

      .env-select--locked &,
      .env-select.locked &,
      .env-select.disabled & {
         @include form.disabled;

         .env-select__input__clear {
            display: none !important;
         }
      }

      .env-select--locked &,
      .env-select.locked & {
         &,
         .env-select__item,
         a,
         button {
            cursor: default !important;
         }
      }

      .env-select.disabled & {
         * {
            cursor: default !important;
         }
      }

      &__clear {
         display: none;
         cursor: pointer;
         position: absolute;
         inset-block-start: calc(#{var(--env-spacing-xx-small)} + 1px);
         inset-inline-end: var(--env-spacing-xxx-small);
         color: var(--env-form-input-font-color);
         width: 1.4em;
         height: 1.9em;
         line-height: 1.9;
         text-align: center;
      }

      .env-select.has-items &:hover .env-select__input__clear,
      .env-select.has-items &:focus .env-select__input__clear,
      .env-select.has-items.focus & .env-select__input__clear {
         display: block;
      }
   }

   &__item {
      cursor: pointer;
      margin-block-start: 0;
      margin-inline-end: functions.em(4px, 14px);
      margin-block-end: functions.em(4px, 14px);
      margin-inline-start: 0;
      align-items: center;
      display: flex;
      border-radius: var(--env-border-radius-medium);
      font-size: functions.em(14px);
      line-height: 1;
      padding-block: functions.em(10px, 14px);
      padding-inline: functions.em(10px, 14px);
      color: var(--env-element-primary-font-color);
      background-color: var(--env-element-primary-background-color);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;

      .plugin-remove_button & {
         padding-block-start: 0;
         padding-inline-end: 0;
         padding-block-end: 0;
         padding-inline-start: functions.em(10px, 14px);
      }

      &__remove {
         text-decoration: none !important;
         color: var(--env-element-primary-font-color);
         padding-block: functions.em(9px, 14px);
         padding-inline: functions.em(7px, 14px);
      }
   }

   &__dropdown {
      display: none;
      background-color: var(--env-section-background-color);
      color: var(--env-font-color);
      border: $border-width $border-style var(--env-border-color-05);
      border-radius: var(--env-border-radius-medium);
      box-shadow: var(--env-box-shadow-small);
      position: absolute;
      inset-block-start: calc(100% + 4px);
      inset-inline-end: 0;
      inset-inline-start: 0;
      z-index: $zindex-tagselect;
      font-size: var(--env-font-size-medium);

      &__content {
         padding-block: var(--env-spacing-x-small);
         padding-inline: 0;
         max-height: 200px;
         overflow-x: hidden;
         overflow-y: auto;
         scroll-behavior: smooth;
      }

      .create,
      .no-results,
      &__option {
         padding-block: var(--env-spacing-x-small);
         padding-inline: var(--env-spacing-x-small);
      }

      .create,
      &__option {
         &:hover,
         &.active {
            background-color: var(--env-section-background-color-05);
            color: var(--env-font-color);
         }
      }
   }

   &__spinner {
      display: inline-block;
      margin-block-start: var(--env-spacing-small);
      margin-inline-end: auto;
      margin-block-end: 0;
      margin-inline-start: 0;
      padding-block-start: 0;
      padding-inline-end: 0;
      padding-block-end: 0;
      padding-inline-start: var(--env-spacing-x-small);
   }
}
